## reload 重载文件的步骤
1. 使用reload命令或者kill 向master发送HUP信号
2. master进程检查配置文件是否有语法错误
3. 如果配置文件中有新加入的端口则会监听新的端口
4. master进程会使用新的配置来启动新的woker进程
5. master经常会向老的woker经常发送QUIT信号
6. 旧的woker经常会关闭监听句柄，把请求处理完后退出该进程

## Nginx的进程架构

https://blog.csdn.net/liuxiao723846/article/details/103203619  进程绑定CPU核心以提高性能

https://www.zbpblog.com/blog-143.html Nginx架构篇


### Nginx热升级

1. 下载升级的nginx版本
```bash
# 安装nginx依赖的库这里忽略
# 安装nginx
./configure
make 
#千万不要执行make install
```
记住这里的./configure需要携带的参数，必须和现有的nginx安装时保持一致。不然Log、config等文件配置目录不一样，这个需要特别注意

2. 移动安装的nginx二进制到sbin目录下
```bash
mv /usr/local/nginx/sbin/nginx  nginx.bak
mv objs  /usr/local/nginx/sbin
```

3. 向master进程发送USR2信号
```
#获取nginx master 进程号
ps aux | grep nginx
# 向master进程发送USR2信号
kill -s SIGUSR2 4219
```

在执行SIGUSR2信号时，会存在新的master进程和旧的master进程都存在的情况。

这是master进程用新的nginx文件启动的新的master进程。

并且还会把之前的`logs/nginx.pid`改名为`nginx.pid.oldbin`,并建立一个新的master进程号的`nginx.pid`

4. 给旧的master进程发送SIGWINCH信号， 并退出旧的woker进程。	
在第三步的命令执行后，会有新旧master进程和woker进程共存，如果旧的woker进程不处理请求，需要退出，而退出的时候不能影响worker中正在处理的请求。

```bash
# 使用WINCH信号
 kill -s SIGWINCH 4219
```